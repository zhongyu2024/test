<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pinhaha.mapper.AppPointMapper">
	<select id="getAll" parameterType="Map" resultType="Map">
		select sum(change_num),user_id ,u.user_name,u.phone
		from app_point p
		left join app_user u on u.id=p.user_id
		where 1=1
		<if test="user_name!=null and user_name!=''">
			and user_name=#{user_name}
		</if>
		<if test="phone!= null and phone!=''">
			and phone=#{phone}
		</if>
		GROUP BY user_id
		limit #{page},#{limit}
	</select>
	<select id="getAllCount" parameterType="Map" resultType="int">
		select count(1) from (
		select user_id
		from app_point p
		left join app_user u on u.id=p.user_id
		where 1=1
		<if test="user_name!=null and user_name!=''">
			and user_name=#{user_name}
		</if>
		<if test="phone!= null and phone!=''">
			and phone=#{phone}
		</if>
		GROUP BY user_id ) a
	</select>
</mapper>